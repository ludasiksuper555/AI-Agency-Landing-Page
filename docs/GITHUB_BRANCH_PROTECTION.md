# Налаштування захисту гілок GitHub згідно ISO 27001

Цей документ містить інструкції щодо налаштування Branch Protection Rules для забезпечення контролю доступу та запобігання несанкціонованим змінам у репозиторії згідно з вимогами ISO 27001.

## Загальні принципи

- Прямі зміни в основних гілках заборонені
- Всі зміни повинні проходити через Pull Requests
- Pull Requests повинні отримати схвалення від відповідальних осіб
- Автоматичні перевірки (CI/CD) повинні успішно завершитися перед злиттям змін

## Покрокові інструкції

### 1. Налаштування захисту для основної гілки (main/master)

1. Перейдіть до налаштувань репозиторію: **Settings > Branches**
2. Натисніть **Add branch protection rule**
3. У полі **Branch name pattern** введіть `main` (або `master`)
4. Налаштуйте наступні параметри:

#### Основні налаштування

- [x] **Require a pull request before merging**

  - [x] **Require approvals** (встановіть мінімум 2 схвалення)
  - [x] **Dismiss stale pull request approvals when new commits are pushed**
  - [x] **Require review from Code Owners**

- [x] **Require status checks to pass before merging**

  - [x] **Require branches to be up to date before merging**
  - Додайте необхідні перевірки (наприклад, `ci/github-actions`)

- [x] **Require conversation resolution before merging**

#### Додаткові налаштування

- [x] **Restrict who can push to matching branches**

  - Додайте тільки адміністраторів проекту

- [x] **Do not allow bypassing the above settings**

### 2. Налаштування захисту для гілок релізів

1. Створіть нове правило з шаблоном імені `release/*`
2. Налаштуйте параметри аналогічно основній гілці

### 3. Налаштування захисту для гілок розробки

1. Створіть нове правило з шаблоном імені `develop`
2. Налаштуйте менш суворі параметри:
   - [x] **Require a pull request before merging**
     - [x] **Require approvals** (встановіть мінімум 1 схвалення)
   - [x] **Require status checks to pass before merging**

## Налаштування CODEOWNERS

Файл CODEOWNERS визначає, хто відповідає за певні частини коду та чиє схвалення потрібне для внесення змін.

1. Створіть або оновіть файл `.github/CODEOWNERS`:

```
# Власники безпеки
/src/utils/security-utils.js @security-team
/lib/userActivityTracker.ts @security-team
/middleware/ @security-team
/lib/securityEventLogger.ts @security-team

# Власники API
/pages/api/ @api-team

# Власники документації
/docs/ @docs-team
```

## Налаштування шаблонів для Pull Requests

1. Створіть файл `.github/PULL_REQUEST_TEMPLATE.md`:

```markdown
## Опис змін

<!-- Опишіть зміни, які ви пропонуєте -->

## Пов'язані Issues

<!-- Вкажіть пов'язані Issues, наприклад: Fixes #123 -->

## Тип змін

- [ ] Виправлення помилки (non-breaking change)
- [ ] Нова функціональність (non-breaking change)
- [ ] Зміна, що порушує сумісність (breaking change)
- [ ] Документація або рефакторинг

## Контрольний список безпеки

- [ ] Я перевірив код на відсутність вразливостей
- [ ] Я не додав конфіденційні дані (паролі, токени, ключі)
- [ ] Я оновив документацію з безпеки (якщо потрібно)

## Контрольний список якості

- [ ] Мій код відповідає стилю цього проекту
- [ ] Я додав тести, що покривають мої зміни
- [ ] Всі тести проходять
- [ ] Я оновив документацію

## Додаткова інформація

<!-- Будь-яка додаткова інформація, контекст або скріншоти -->
```

## Перевірка налаштувань

Після налаштування захисту гілок, перевірте їх ефективність:

1. Спробуйте зробити прямий push в захищену гілку (повинен бути відхилений)
2. Створіть Pull Request без необхідних схвалень (злиття повинно бути заблоковане)
3. Створіть Pull Request з помилками в CI/CD (злиття повинно бути заблоковане)

## Додаткові заходи безпеки

- Налаштуйте обов'язкову двофакторну аутентифікацію (2FA) для всіх учасників проекту
- Регулярно перевіряйте журнали доступу до репозиторію
- Проводьте періодичний аудит прав доступу

## Відповідність ISO 27001

Ці налаштування відповідають вимогам ISO 27001 щодо контролю доступу та забезпечують:

- Принцип найменших привілеїв
- Розподіл обов'язків
- Контроль змін
- Аудит та моніторинг
- Захист від несанкціонованих змін
